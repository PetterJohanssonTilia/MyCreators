{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 text-center">
            <div class="creator-nav">
                <button type="button" id="explore_button" class="creator-button active" data-target="explore">Explore Creators</button>
                <button type="button" id="followed_button" class="creator-button unactive" data-target="followed">Followed Creators</button>
                {% if user.is_superuser or user.is_staff %}
                    <button type="button" id="pending_button" class="creator-button unactive" data-target="pending">Pending Creators</button>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row justify-content-center mt-3">
        <div class="col-md-8">
            <div class="filter-buttons text-center">
                <button class="filter-btn active" data-filter="all">All</button>
                {% for type_key, type_name in creator_types.items %}
                    <button class="filter-btn" data-filter="{{ type_key }}">{{ type_name }}</button>
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="mt-4">
        <div id="explore_creators" class="shown">
            <div class="row">
                {% for creator in creators %}
                    <div class="col-md-4 mb-4">
                        <div class="card creator-item" data-type="{{ creator.creator_type }}" style="width: 18rem;">
                            <a href="{% url 'creator_aboutme' username=creator.user.username %}">
                                {% if creator.avatar %}
                                    <img class="card-img-top" src="{{ creator.avatar.url }}" alt="{{ creator.user.username }}'s avatar" class="avatar">
                                {% else %}
                                    <img class="card-img-top" src="{% static 'images/placeholderavatar.png' %}" alt="{{ creator.user.username }}'s avatar" class="avatar">
                                {% endif %}
                            </a>
                            <div class="card-body">
                                <a href="{% url 'creator_aboutme' username=creator.user.username %}">
                                    <h5 class="card-title">{{ creator.user.username }}</h5>
                                </a>
                                <p class="card-text">{{ creator.about_me|truncatewords:20 }}</p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div id="followed_creators" class="hidden">
            <div class="row">
                {% if followed_creators %}
                    {% for creator in followed_creators %}
                        <div class="col-md-4 mb-4">
                            <div class="card" style="width: 18rem;">
                                <a href="{% url 'creator_aboutme' username=creator.user.username %}">
                                    {% if creator.avatar %}
                                        <img class="card-img-top" src="{{ creator.avatar.url }}" alt="{{ creator.user.username }}'s avatar" class="avatar">
                                    {% else %}
                                        <img class="card-img-top" src="{% static 'images/placeholderavatar.png' %}" alt="{{ creator.user.username }}'s avatar" class="avatar">
                                    {% endif %}
                                </a>
                                <div class="card-body">
                                    <a href="{% url 'creator_aboutme' username=creator.user.username %}">
                                        <h5 class="card-title">{{ creator.user.username }}</h5>
                                    </a>
                                    <p class="card-text">{{ creator.about_me|truncatewords:20 }}</p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    {% else %}
                        <div class="col-12">
                            <p>You are not following any creators yet.</p>
                        </div>                
                {% endif %}
            </div>
        </div>
    {% if user.is_superuser or user.is_staff %}
        <div id="pending_creators" class="hidden">
            <div class="row">
                {% if pending_creators %}
                    {% for creator in pending_creators %}
                        <div class="col-md-4 mb-4">
                            <div class="card" style="width: 18rem;">
                                <a href="{% url 'creator_aboutme' username=creator.user.username %}">
                                    {% if creator.avatar %}
                                        <img class="card-img-top" src="{{ creator.avatar.url }}" alt="{{ creator.user.username }}'s avatar" class="avatar">
                                    {% else %}
                                        <img class="card-img-top" src="{% static 'images/placeholderavatar.png' %}" alt="{{ creator.user.username }}'s avatar" class="avatar">
                                    {% endif %}
                                </a>
                                <div class="card-body">
                                    <h5 class="card-title">{{ creator.user.username }}</h5>
                                    <p class="card-text"><strong>Status:</strong> PENDING</p>
                                    <p class="card-text"><strong>Request Message:</strong></p>
                                    <p class="card-text">{{ creator.about_me|truncatewords:30 }}</p>
                                    <form action="{% url 'approve_creator' username=creator.user.username %}" method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-success btn-sm">Approve</button>
                                    </form>
                                    <form action="{% url 'reject_creator' username=creator.user.username %}" method="post" style="display: inline;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="col-12">
                        <p>There are no pending creator requests.</p>
                    </div>                
            {% endif %}
            </div>
        </div>
    {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_scripts %}
    <script>
        /* ===== Explore/Followed/Pending switch ====== */
        document.addEventListener('DOMContentLoaded', function () {
            const pending_button = document.getElementById('pending_button');
            const explore_button = document.getElementById('explore_button');
            const followed_button = document.getElementById('followed_button');
            const explore_creators = document.getElementById('explore_creators');
            const followed_creators = document.getElementById('followed_creators');
            const pending_creators = document.getElementById('pending_creators');

            explore_button.addEventListener('click', function () {
                explore_creators.classList.add('shown');
                explore_creators.classList.remove('hidden');
                explore_button.classList.add('active');
                explore_button.classList.remove('unactive');
                followed_button.classList.add('unactive');
                followed_button.classList.remove('active');
                followed_creators.classList.add('hidden');
                followed_creators.classList.remove('shown');
                pending_creators.classList.add('hidden');
                pending_creators.classList.remove('shown');
                pending_button.classList.add('unactive');
                pending_button.classList.remove('active');        
            });

            followed_button.addEventListener('click', function () {
                followed_creators.classList.add('shown');
                followed_creators.classList.remove('hidden');
                followed_button.classList.add('active');
                followed_button.classList.remove('unactive');
                explore_button.classList.add('unactive');
                explore_button.classList.remove('active');
                explore_creators.classList.add('hidden');
                explore_creators.classList.remove('shown');
                pending_creators.classList.add('hidden');
                pending_creators.classList.remove('shown');
                pending_button.classList.add('unactive');
                pending_button.classList.remove('active');
            });

            pending_button.addEventListener('click', function () {
                pending_button.classList.add('active');
                pending_button.classList.remove('unactive');
                pending_creators.classList.add('shown');
                pending_creators.classList.remove('hidden');
                followed_creators.classList.add('hidden');
                followed_creators.classList.remove('shown');
                followed_button.classList.add('unactive');
                followed_button.classList.remove('active');
                explore_button.classList.add('unactive');
                explore_button.classList.remove('active');
                explore_creators.classList.add('hidden');
                explore_creators.classList.remove('shown');
            });
        /* ===== Creator type tags buttons ====== */
            const filterButtons = document.querySelectorAll('.filter-btn');
            const creatorItems = document.querySelectorAll('.creator-item');

            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');

                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    creatorItems.forEach(item => {
                        if (filter === 'all' || item.getAttribute('data-type') === filter) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
        });
    </script>
{% endblock %}